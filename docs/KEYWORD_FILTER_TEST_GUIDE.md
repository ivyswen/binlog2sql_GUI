# SQL 关键字过滤功能 - 测试指南

## 🎯 测试目的

验证 SQL 关键字过滤功能的 Bug 修复是否有效，确保功能正常工作。

---

## 📋 测试前准备

### 1. 确认修复已应用
- 检查 `gui/main_window.py` 文件是否包含最新修改
- 确认关键字过滤初始化在 `clear_results()` 之后

### 2. 准备测试环境
- MySQL 数据库（5.7 或 8.0）
- 已启用 binlog
- 有测试数据的数据库

### 3. 准备测试数据
确保数据库中有不同类型的 SQL 操作：
- INSERT 语句
- UPDATE 语句
- DELETE 语句

---

## 🧪 测试用例

### 测试用例 1：基本过滤功能

**目的**：验证关键字过滤基本功能

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`UPDATE`
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] 开始初始化关键字过滤
  [INFO] 关键字过滤已启用，输入的关键字文本: 'UPDATE'
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['UPDATE']
  ```
- 解析完成后显示：
  ```
  [INFO] 检查关键字过滤状态 - 启用: True, 关键字列表: ['UPDATE']
  [INFO] ✓ 关键字过滤统计 - 总处理: XXX, 匹配: XXX, 过滤: XXX
  ```
- 结果区域只显示 UPDATE 语句

**判断标准**：
- ✅ 日志中有关键字过滤初始化信息
- ✅ 日志中有过滤统计信息
- ✅ 结果中只有 UPDATE 语句

---

### 测试用例 2：多关键字过滤（空格分隔）

**目的**：验证多关键字过滤功能

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`UPDATE DELETE`
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['UPDATE', 'DELETE']
  ```
- 结果区域显示 UPDATE 和 DELETE 语句

**判断标准**：
- ✅ 关键字列表包含两个关键字
- ✅ 结果中有 UPDATE 和 DELETE 语句
- ✅ 没有 INSERT 语句

---

### 测试用例 3：多关键字过滤（逗号分隔）

**目的**：验证逗号分隔的多关键字

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`UPDATE, DELETE, INSERT`
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['UPDATE', 'DELETE', 'INSERT']
  ```
- 结果区域显示所有类型的 SQL 语句

**判断标准**：
- ✅ 关键字列表包含三个关键字
- ✅ 结果中有所有类型的 SQL 语句

---

### 测试用例 4：表名过滤

**目的**：验证通过表名过滤

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`users` （假设有 users 表）
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['USERS']
  ```
- 结果区域只显示涉及 users 表的 SQL 语句

**判断标准**：
- ✅ 结果中只有涉及 users 表的 SQL
- ✅ 没有其他表的 SQL

---

### 测试用例 5：不区分大小写

**目的**：验证关键字匹配不区分大小写

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`update` （小写）
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['UPDATE']
  ```
- 结果区域显示 UPDATE 语句（无论 SQL 中是大写还是小写）

**判断标准**：
- ✅ 关键字被转换为大写
- ✅ 匹配不区分大小写

---

### 测试用例 6：未输入关键字

**目的**：验证启用过滤但未输入关键字的情况

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. **不输入关键字**（文本框为空）
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [WARNING] 关键字过滤已启用但未输入关键字
  ```
- 结果区域显示所有 SQL 语句（因为没有有效的关键字）

**判断标准**：
- ✅ 日志中有警告信息
- ✅ 显示所有 SQL 语句

---

### 测试用例 7：禁用过滤

**目的**：验证禁用过滤功能

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ❌ **不勾选**"启用关键字过滤"
5. 点击"开始解析"
6. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] 关键字过滤未启用
  ```
- 解析完成后显示：
  ```
  [INFO] 关键字过滤未启用
  ```
- 结果区域显示所有 SQL 语句

**判断标准**：
- ✅ 日志中说明过滤未启用
- ✅ 显示所有 SQL 语句

---

### 测试用例 8：无匹配结果

**目的**：验证没有匹配关键字的情况

**步骤**：
1. 启动应用
2. 选择数据库连接
3. 配置 binlog 文件范围
4. ✅ 勾选"启用关键字过滤"
5. 输入关键字：`NONEXISTENT` （不存在的关键字）
6. 点击"开始解析"
7. 等待解析完成

**预期结果**：
- 日志中显示：
  ```
  [INFO] ✓ 关键字过滤初始化成功，关键字列表: ['NONEXISTENT']
  [INFO] ✓ 关键字过滤统计 - 总处理: XXX, 匹配: 0, 过滤: XXX
  [WARNING] 未找到匹配关键字的SQL语句
  ```
- 结果区域为空或显示"SQL语句数: 0"

**判断标准**：
- ✅ 日志中有警告信息
- ✅ 匹配数为 0
- ✅ 结果区域为空

---

## 📊 测试结果记录表

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1. 基本过滤功能 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 2. 多关键字（空格） | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 3. 多关键字（逗号） | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 4. 表名过滤 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 5. 不区分大小写 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 6. 未输入关键字 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 7. 禁用过滤 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 8. 无匹配结果 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |

---

## 🔍 调试技巧

### 查看日志

1. **找到日志文件**：
   - 日志文件通常在应用目录的 `logs` 文件夹中
   - 文件名格式：`binlog2sql_YYYY-MM-DD.log`

2. **搜索关键信息**：
   ```
   关键字过滤
   keyword_filters
   matched_sql_count
   filtered_sql_count
   ```

3. **验证日志内容**：
   - 检查是否有"✓ 关键字过滤初始化成功"
   - 检查是否有"✓ 关键字过滤统计"
   - 检查关键字列表是否正确

### 常见问题排查

**问题 1**：日志中没有过滤统计信息
- 检查是否勾选了"启用关键字过滤"
- 检查是否输入了关键字
- 查看日志中的警告信息

**问题 2**：过滤结果不正确
- 检查关键字是否正确
- 检查关键字列表是否包含预期的关键字
- 验证 SQL 语句是否真的包含关键字

**问题 3**：没有匹配的 SQL
- 检查关键字是否存在于 binlog 中
- 尝试使用更通用的关键字（如 UPDATE）
- 检查时间范围和表过滤条件

---

## ✅ 测试通过标准

所有测试用例都应该通过，具体标准：

1. **日志完整性**：
   - ✅ 有关键字过滤初始化日志
   - ✅ 有过滤统计日志
   - ✅ 日志信息准确

2. **功能正确性**：
   - ✅ 过滤逻辑正确
   - ✅ 关键字匹配准确
   - ✅ 统计数据正确

3. **用户体验**：
   - ✅ 界面响应正常
   - ✅ 提示信息清晰
   - ✅ 无错误或崩溃

---

**测试指南版本**：1.0  
**创建日期**：2025-10-17  
**创建者**：The Augster


# Binlog2SQL GUI 使用示例

## 快速开始

### 1. 启动应用程序

```bash
uv run python main.py
```

### 2. 配置数据库连接

1. 点击左侧"连接"下拉框旁的"新建"按钮
2. 填写数据库连接信息：
   - **连接名称**: `本地MySQL` (自定义名称)
   - **主机地址**: `127.0.0.1`
   - **端口**: `3306`
   - **用户名**: `root`
   - **密码**: `your_password`
   - **字符集**: `utf8`

3. 点击"测试连接"验证连接是否正常
4. 点击"确定"保存连接配置

### 3. 配置解析参数

#### Binlog配置
- **起始文件**: `mysql-bin.000001` (根据实际情况填写)
- **起始位置**: `4` (默认值)
- **结束文件**: 留空表示与起始文件相同
- **结束位置**: `0` (表示最新位置)

#### 时间过滤
- **启用时间过滤**: 勾选此选项启用时间范围过滤
- **开始时间**: 选择要解析的开始时间（启用时间过滤时生效）
- **结束时间**: 选择要解析的结束时间（启用时间过滤时生效）

**注意**:
- 启用时间过滤时，只解析指定时间范围内的binlog事件
- 禁用时间过滤时，解析所有时间范围的数据（相当于从1980年到2999年）

#### 过滤选项
- **数据库**: 留空表示所有数据库，或填写 `test_db production_db`
- **表**: 留空表示所有表，或填写 `users orders`

#### 解析选项
- ✅ **INSERT**: 解析INSERT语句
- ✅ **UPDATE**: 解析UPDATE语句
- ✅ **DELETE**: 解析DELETE语句
- ✅ **只显示DML语句**: 只显示数据操作语句
- ⬜ **生成回滚SQL**: 生成用于回滚的SQL
- ⬜ **不包含主键**: INSERT语句不包含主键
- **回滚间隔**: `1.0` 秒

### 4. 开始解析

1. 确认所有配置正确
2. 点击"开始解析"按钮
3. 在右侧面板查看实时解析结果
4. 可以随时点击"停止解析"中断解析

### 5. 处理结果

- **复制全部**: 将所有SQL语句复制到剪贴板
- **保存到文件**: 将结果保存为.sql文件
- **清空**: 清空当前显示的结果

## 实际使用场景

### 场景1: 数据恢复

假设误删了用户表中的数据，需要找到删除操作并生成恢复SQL：

1. **配置解析参数**:
   - 时间范围: 设置为误删操作发生的时间段
   - 数据库: `production`
   - 表: `users`
   - SQL类型: 只选择 `DELETE`

2. **开始解析**: 找到删除操作的SQL语句

3. **生成回滚SQL**:
   - 勾选"生成回滚SQL"
   - 重新解析，获得INSERT语句用于恢复数据

### 场景2: 审计数据变更

监控特定表的数据变更：

1. **配置解析参数**:
   - 时间范围: 设置为需要审计的时间段
   - 数据库: `audit_db`
   - 表: `sensitive_table`
   - SQL类型: 选择所有类型

2. **开始解析**: 查看所有数据变更操作

3. **导出结果**: 保存为文件用于审计报告

### 场景3: 数据同步验证

验证主从同步的数据一致性：

1. **配置解析参数**:
   - 启用时间过滤，设置同步时间段
   - 选择需要验证的数据库和表

2. **解析主库binlog**: 获取主库的变更SQL

3. **对比验证**: 与从库数据进行对比验证

### 场景4: 全量数据分析

分析整个binlog文件的所有变更：

1. **配置解析参数**:
   - 禁用时间过滤，解析所有时间范围的数据
   - 选择要分析的数据库和表
   - 选择所有SQL类型

2. **开始解析**: 获取完整的数据变更历史

3. **数据分析**: 分析数据变更趋势和模式

## 注意事项

### MySQL配置要求

确保MySQL配置正确：

```sql
-- 检查binlog是否启用
SHOW VARIABLES LIKE 'log_bin';

-- 检查binlog格式
SHOW VARIABLES LIKE 'binlog_format';

-- 查看当前binlog文件
SHOW MASTER STATUS;

-- 查看所有binlog文件
SHOW MASTER LOGS;
```

### 用户权限要求

解析用户需要以下权限：

```sql
-- 创建专用用户
CREATE USER 'binlog_reader'@'%' IDENTIFIED BY 'secure_password';

-- 授予必要权限
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'binlog_reader'@'%';

-- 刷新权限
FLUSH PRIVILEGES;
```

### 性能考虑

1. **大文件解析**: 解析大的binlog文件可能需要较长时间
2. **网络延迟**: 远程数据库连接可能影响解析速度
3. **内存使用**: 大量SQL结果会占用内存，建议及时清空或保存

### 常见问题

1. **连接失败**: 检查网络连接、用户权限、防火墙设置
2. **找不到binlog文件**: 确认文件名正确，检查binlog是否启用
3. **解析结果为空**: 检查时间范围、过滤条件是否正确
4. **权限错误**: 确保用户有REPLICATION权限

## 高级功能

### 自定义过滤

可以通过以下方式精确控制解析范围：

- **位置过滤**: 使用起始和结束位置精确控制
- **时间过滤**: 使用时间范围过滤事件
- **表过滤**: 只解析特定表的变更
- **SQL类型过滤**: 只关注特定类型的操作

### 批量处理

对于大量binlog文件的处理：

1. 按时间段分批解析
2. 使用脚本自动化处理
3. 结合其他工具进行数据分析

这个GUI工具让MySQL binlog解析变得简单直观，无需记忆复杂的命令行参数！
